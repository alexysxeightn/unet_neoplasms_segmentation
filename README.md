# Сервис сегментации новообразований на основе PyTorch(U-NET) + Streamlit

Простой веб-сервис для сегментации новообразований с использованием модели U-NET, реализованной на `PyTorch`, и интерфейса на `Streamlit`. Позволяет загружать одно или несколько изображений (включая формат `.bmp`), применять модель и отображать результаты с нанесённой маской.

Модель обучалась на датасете ![PH2Dataset](https://www.kaggle.com/datasets/kanametov/ph2dataset)

## Структура проекта

```
│
├── train.ipynb            # Jupyter с обучением модели U-NET
├── unet.pth               # Веса модели U-NET
├── app.py                 # Основное приложение Streamlit
├── model.py               # Логика загрузки и инференса модели
├── utils.py               # Функции предобработки и постобработки
├── requirements.txt       # Список зависимостей
└── README.md              # Документация
```

## Установка

1. Клонировать репозиторий
```
git clone https://github.com/alexysxeightn/unet_neoplasms_segmentation.git
cd unet_neoplasms_segmentation
```

2. Установить зависимости
```
pip install -r requirements.txt
```

3. Запустить приложение
```
streamlit run app.py
```

## Как использовать

1. Загрузите одно или несколько изображений (можно зажать Ctrl/Cmd для множественного выбора).
2. Нажмите кнопку "Выполнить сегментацию".
3. Результаты будут показаны в виде галереи:
- Оригинал
- Изображение с маской (синяя полупрозрачная область)

## Архитектура модели

В проекте используется модель типа U-Net — популярная архитектура для задач семантической сегментации изображений. Она состоит из энкодера (`downsampler`) и декодера (`upsampler`) с механизмом skip-соединений, что позволяет сохранять детали изображения на разных уровнях абстракции.

Для выбора лучшей модели в качестве метрики использовалось среднее `IoU` - степень пересечения между предсказанной маской и истинной маской (ground truth):
$$
IoU = \frac{Пересечение (TP)}{Объединение (TP + FP + FN)}
$$
- `TP (True Positive)` — пиксели, правильно классифицированные как объект.
- `FP (False Positive)` — пиксели, ошибочно отнесённые к объекту.
- `FN (False Negative)` — пиксели объекта, ошибочно отнесённые к фону.

### Общая структура:
- `DoubleConv`: два последовательных блока свёртки + `BatchNorm` + `ReLU`
- `MaxPool2d`: уменьшает размерность пространственного представления в 2 раза
- `ConvTranspose2d`: увеличивает пространственные размерности (transposed convolution / deconvolution)
- `Skip-connections`: соединяют соответствующие слои энкодера и декодера
- `Bottleneck`: самый глубокий слой между энкодером и декодером
- `Final Convolution`: преобразует фичи в выходной канал маски

### Параметры модели:
```
UNET(
  in_channels=3,
  out_channels=1,
  features=[64, 128, 256, 512]
)
```
- `in_channels`: 3 (RGB)
- `out_channels`: 1 (бинарная маска)
- `features`: количество фильтров на каждом уровне энкодера

Подробно архитектура модели разобрана в статье ![U-Net: Convolutional Networks for Biomedical Image Segmentation](https://arxiv.org/abs/1505.04597)